{% extends "unfold/layouts/base.html" %}
{% load static %}
{% load i18n %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrastyle %}
<link rel="stylesheet" href="{% static 'citizens/css/citizen_dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="citizen-dashboard">
    <!-- Breadcrumbs -->
    <div class="breadcrumbs">
        <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
        &rsaquo; <a href="{% url 'admin:citizens_citizen_changelist' %}">Î Î¿Î»Î¯Ï„ÎµÏ‚</a>
        &rsaquo; <span>{{ citizen.full_name }}</span>
    </div>

    <!-- Header - Enhanced with Gradient Background -->
    <div class="dashboard-header">
        <div>
            <h1>{{ citizen.full_name }}</h1>
            {% if citizen.ÎºÎ¹Î½Î·Ï„Î¿ %}
            <div style="margin-top: 8px; opacity: 0.9; display: flex; gap: 16px;">
                <a href="tel:{{ citizen.ÎºÎ¹Î½Î·Ï„Î¿ }}" style="color: white; text-decoration: none; font-size: 14px;">
                    ğŸ“ {{ citizen.ÎºÎ¹Î½Î·Ï„Î¿ }}
                </a>
                {% if citizen.email %}
                <a href="mailto:{{ citizen.email }}" style="color: white; text-decoration: none; font-size: 14px;">
                    âœ‰ï¸ {{ citizen.email }}
                </a>
                {% endif %}
            </div>
            {% endif %}
        </div>
        <div class="header-actions">
            <a href="{% url 'admin:citizens_citizen_change' citizen.pk %}" class="button">
                âœï¸ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±
            </a>
            <a href="{% url 'admin:citizens_citizen_changelist' %}" class="button">
                â¬…ï¸ Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î· Î›Î¯ÏƒÏ„Î±
            </a>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="quick-stats">
        <div class="stat-card">
            <div class="stat-icon">ğŸ“</div>
            <div class="stat-info">
                <div class="stat-value">{{ requests_count }}</div>
                <div class="stat-label">Î£Ï…Î½Î¿Î»Î¹ÎºÎ¬ Î‘Î¹Ï„Î®Î¼Î±Ï„Î±</div>
            </div>
        </div>
        <div class="stat-card {% if active_requests_count > 0 %}stat-warning{% endif %}">
            <div class="stat-icon">â³</div>
            <div class="stat-info">
                <div class="stat-value">{{ active_requests_count }}</div>
                <div class="stat-label">Î•Î½ÎµÏÎ³Î¬ Î‘Î¹Ï„Î®Î¼Î±Ï„Î±</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸ’¬</div>
            <div class="stat-info">
                <div class="stat-value">{{ communications_count }}</div>
                <div class="stat-label">Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯ÎµÏ‚</div>
            </div>
        </div>
        {% if has_military %}
        <div class="stat-card stat-success">
            <div class="stat-icon">ğŸ–ï¸</div>
            <div class="stat-info">
                <div class="stat-value">{{ military_personnel.get_Ï„Ï…Ï€Î¿Ï‚_display }}</div>
                <div class="stat-label">Î£Ï„ÏÎ±Ï„Î¹Ï‰Ï„Î¹ÎºÏŒ Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ</div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
        <div class="tabs-header">
            <a href="?tab=basic" class="tab {% if active_tab == 'basic' %}active{% endif %}">
                ğŸ“‹ Î’Î±ÏƒÎ¹ÎºÎ¬ Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î±
            </a>
            <a href="?tab=requests" class="tab {% if active_tab == 'requests' %}active{% endif %}">
                ğŸ“ Î‘Î¹Ï„Î®Î¼Î±Ï„Î±
                {% if requests_count > 0 %}
                <span class="badge">{{ requests_count }}</span>
                {% endif %}
            </a>
            <a href="?tab=communications" class="tab {% if active_tab == 'communications' %}active{% endif %}">
                ğŸ’¬ Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯ÎµÏ‚
                {% if communications_count > 0 %}
                <span class="badge">{{ communications_count }}</span>
                {% endif %}
            </a>
            {% if has_military %}
            <a href="?tab=military" class="tab {% if active_tab == 'military' %}active{% endif %}">
                ğŸ–ï¸ Î£Ï„ÏÎ±Ï„Î¹Ï‰Ï„Î¹ÎºÏŒ Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ
            </a>
            {% endif %}
        </div>

        <div class="tabs-content">
            <!-- Tab: Î’Î±ÏƒÎ¹ÎºÎ¬ Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± -->
            <div class="tab-pane {% if active_tab == 'basic' %}active{% endif %}">
                <div class="info-grid">
                    <div class="info-section">
                        <h2>Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ¬ Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î±</h2>
                        <table class="info-table">
                            <tr>
                                <th>Î•Ï€ÏÎ½Ï…Î¼Î¿:</th>
                                <td>{{ citizen.ÎµÏ€Î¹Î¸ÎµÏ„Î¿ }}</td>
                            </tr>
                            <tr>
                                <th>ÎŒÎ½Î¿Î¼Î±:</th>
                                <td>{{ citizen.Î¿Î½Î¿Î¼Î± }}</td>
                            </tr>
                            <tr>
                                <th>Î Î±Ï„ÏÏÎ½Ï…Î¼Î¿:</th>
                                <td>{{ citizen.Ï€Î±Ï„ÏÏ‰Î½Ï…Î¼Î¿|default:"-" }}</td>
                            </tr>
                            <tr>
                                <th>Î£ÏÏƒÏ„Î±ÏƒÎ· Î±Ï€ÏŒ:</th>
                                <td>{{ citizen.ÏƒÏ…ÏƒÏ„Î±ÏƒÎ·_Î±Ï€Î¿|default:"-" }}</td>
                            </tr>
                        </table>
                    </div>

                    <div class="info-section">
                        <h2>Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±</h2>
                        <table class="info-table">
                            <tr>
                                <th>ÎšÎ¹Î½Î·Ï„ÏŒ:</th>
                                <td>{{ citizen.ÎºÎ¹Î½Î·Ï„Î¿|default:"-" }}</td>
                            </tr>
                            <tr>
                                <th>Î£Ï„Î±Î¸ÎµÏÏŒ:</th>
                                <td>{{ citizen.ÏƒÏ„Î±Î¸ÎµÏÎ¿|default:"-" }}</td>
                            </tr>
                            <tr>
                                <th>Email:</th>
                                <td>{{ citizen.email|default:"-" }}</td>
                            </tr>
                        </table>
                    </div>

                    <div class="info-section">
                        <h2>Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·</h2>
                        <table class="info-table">
                            <tr>
                                <th>Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·:</th>
                                <td>{{ citizen.Î´Î¹ÎµÏ…Î¸Ï…Î½ÏƒÎ·|default:"-" }}</td>
                            </tr>
                            <tr>
                                <th>Î¤Îš:</th>
                                <td>{{ citizen.Ï„Îº|default:"-" }}</td>
                            </tr>
                            <tr>
                                <th>Î”Î®Î¼Î¿Ï‚:</th>
                                <td>{{ citizen.Î´Î·Î¼Î¿Ï‚|default:"-" }}</td>
                            </tr>
                            <tr>
                                <th>Î ÎµÏÎ¹Î¿Ï‡Î®:</th>
                                <td>{{ citizen.Ï€ÎµÏÎ¹Î¿Ï‡Î·|default:"-" }}</td>
                            </tr>
                            <tr>
                                <th>Î•ÎºÎ»Î¿Î³Î¹ÎºÎ® Î ÎµÏÎ¹Ï†Î­ÏÎµÎ¹Î±:</th>
                                <td>{{ citizen.ÎµÎºÎ»Î¿Î³Î¹ÎºÎ·_Ï€ÎµÏÎ¹Ï†ÎµÏÎµÎ¹Î±|default:"-" }}</td>
                            </tr>
                        </table>
                    </div>

                    <div class="info-section">
                        <h2>ÎšÎ±Ï„Î·Î³Î¿ÏÎ¹Î¿Ï€Î¿Î¯Î·ÏƒÎ·</h2>
                        <table class="info-table">
                            <tr>
                                <th>ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î± Î•Ï€Î±Ï†Î®Ï‚:</th>
                                <td>{{ citizen.get_ÎºÎ±Ï„Î·Î³Î¿ÏÎ¹Î±_ÎµÏ€Î±Ï†Î·Ï‚_display|default:"-" }}</td>
                            </tr>
                            <tr>
                                <th>Î™Î´Î¹ÏŒÏ„Î·Ï„Î±:</th>
                                <td>{{ citizen.Î¹Î´Î¹Î¿Ï„Î·Ï„Î±|default:"-" }}</td>
                            </tr>
                            <tr>
                                <th>Î‘ÏÎ¼ÏŒÎ´Î¹Î¿Ï‚ Î£Ï…Î½ÎµÏÎ³Î¬Ï„Î·Ï‚:</th>
                                <td>{{ citizen.Î±ÏÎ¼Î¿Î´Î¹Î¿Ï‚_ÏƒÏ…Î½ÎµÏÎ³Î±Ï„Î·Ï‚|default:"-" }}</td>
                            </tr>
                        </table>
                    </div>
                </div>

                {% if citizen.Ï€Î±ÏÎ±Ï„Î·ÏÎ·ÏƒÎµÎ¹Ï‚ %}
                <div class="info-section full-width">
                    <h2>Î Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚</h2>
                    <div class="notes">{{ citizen.Ï€Î±ÏÎ±Ï„Î·ÏÎ·ÏƒÎµÎ¹Ï‚ }}</div>
                </div>
                {% endif %}
            </div>

            <!-- Tab: Î‘Î¹Ï„Î®Î¼Î±Ï„Î± -->
            <div class="tab-pane {% if active_tab == 'requests' %}active{% endif %}">
                <div class="section-header">
                    <h2>Î‘Î¹Ï„Î®Î¼Î±Ï„Î± ({{ requests_count }})</h2>
                    <a href="{% url 'admin:citizens_request_add' %}?Ï€Î¿Î»Î¹Ï„Î·Ï‚={{ citizen.pk }}" class="button button-add">
                        + ÎÎ­Î¿ Î‘Î¯Ï„Î·Î¼Î±
                    </a>
                </div>

                {% if requests %}
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±</th>
                            <th>ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</th>
                            <th>Î—Î¼/Î½Î¯Î± Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®Ï‚</th>
                            <th>Î—Î¼/Î½Î¯Î± ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ·Ï‚</th>
                            <th>Î—Î¼Î­ÏÎµÏ‚ Î•ÎºÎºÏÎµÎ¼ÏŒÏ„Î·Ï„Î±Ï‚</th>
                            <th>Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for request in requests %}
                        <tr>
                            <td>{{ request.get_ÎºÎ±Ï„Î·Î³Î¿ÏÎ¹Î±_Î±Î¹Ï„Î·Î¼Î±Ï„Î¿Ï‚_display }}</td>
                            <td>
                                <span class="status-badge status-{{ request.ÎºÎ±Ï„Î±ÏƒÏ„Î±ÏƒÎ·|lower }}">
                                    {{ request.get_ÎºÎ±Ï„Î±ÏƒÏ„Î±ÏƒÎ·_display }}
                                </span>
                            </td>
                            <td>{{ request.Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¹Î±_Î±Ï€Î¿ÏƒÏ„Î¿Î»Î·Ï‚|date:"d/m/Y" }}</td>
                            <td>{{ request.Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¹Î±_Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰ÏƒÎ·Ï‚|date:"d/m/Y"|default:"-" }}</td>
                            <td>
                                {% if request.days_pending > 0 %}
                                <span class="days-pending {% if request.days_pending > 25 %}text-danger{% elif request.days_pending > 15 %}text-warning{% endif %}">
                                    {{ request.days_pending }} Î·Î¼Î­ÏÎµÏ‚
                                </span>
                                {% else %}
                                -
                                {% endif %}
                            </td>
                            <td>
                                <a href="{% url 'admin:citizens_request_change' request.pk %}" class="action-link">âœï¸ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="empty-state">
                    <p>Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î±Î¹Ï„Î®Î¼Î±Ï„Î± Î³Î¹Î± Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Ï€Î¿Î»Î¯Ï„Î·.</p>
                    <a href="{% url 'admin:citizens_request_add' %}?Ï€Î¿Î»Î¹Ï„Î·Ï‚={{ citizen.pk }}" class="button">
                        + Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î‘Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚
                    </a>
                </div>
                {% endif %}
            </div>

            <!-- Tab: Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯ÎµÏ‚ -->
            <div class="tab-pane {% if active_tab == 'communications' %}active{% endif %}">
                <div class="section-header">
                    <h2>Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯ÎµÏ‚ ({{ communications_count }})</h2>
                    <a href="{% url 'admin:citizens_communication_add' %}?Ï€Î¿Î»Î¹Ï„Î·Ï‚={{ citizen.pk }}" class="button button-add">
                        + ÎÎ­Î± Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±
                    </a>
                </div>

                {% if communications %}
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</th>
                            <th>Î¤ÏÏ€Î¿Ï‚</th>
                            <th>Î Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚</th>
                            <th>Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Î±Ï€ÏŒ</th>
                            <th>Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for comm in communications %}
                        <tr>
                            <td>{{ comm.Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¹Î±_ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¹Î±Ï‚|date:"d/m/Y" }}</td>
                            <td>
                                <span class="type-badge">{{ comm.get_Ï„Ï…Ï€Î¿Ï‚_display }}</span>
                            </td>
                            <td>{{ comm.Ï€Î±ÏÎ±Ï„Î·ÏÎ·ÏƒÎµÎ¹Ï‚|truncatewords:20 }}</td>
                            <td>{{ comm.created_by|default:"-" }}</td>
                            <td>
                                <a href="{% url 'admin:citizens_communication_change' comm.pk %}" class="action-link">âœï¸ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="empty-state">
                    <p>Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯ÎµÏ‚ Î³Î¹Î± Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Ï€Î¿Î»Î¯Ï„Î·.</p>
                    <a href="{% url 'admin:citizens_communication_add' %}?Ï€Î¿Î»Î¹Ï„Î·Ï‚={{ citizen.pk }}" class="button">
                        + Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚
                    </a>
                </div>
                {% endif %}
            </div>

            <!-- Tab: Î£Ï„ÏÎ±Ï„Î¹Ï‰Ï„Î¹ÎºÏŒ Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ -->
            {% if has_military %}
            <div class="tab-pane {% if active_tab == 'military' %}active{% endif %}">
                <div class="section-header">
                    <h2>Î£Ï„ÏÎ±Ï„Î¹Ï‰Ï„Î¹ÎºÏŒ Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ</h2>
                    <a href="{% url 'admin:citizens_militarypersonnel_change' military_personnel.pk %}" class="button">
                        âœï¸ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±
                    </a>
                </div>

                <div class="info-grid">
                    <div class="info-section">
                        <h2>Î¤ÏÏ€Î¿Ï‚ & Î’Î±ÏƒÎ¹ÎºÎ¬</h2>
                        <table class="info-table">
                            <tr>
                                <th>Î¤ÏÏ€Î¿Ï‚:</th>
                                <td>
                                    <span class="status-badge status-success">
                                        {{ military_personnel.get_Ï„Ï…Ï€Î¿Ï‚_display }}
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <th>Î Î»Î®ÏÎµÏ‚ ÎŒÎ½Î¿Î¼Î±:</th>
                                <td>{{ military_personnel.full_name }}</td>
                            </tr>
                        </table>
                    </div>

                    {% if military_personnel.Ï„Ï…Ï€Î¿Ï‚ == 'Î£Î¤Î¡Î‘Î¤Î™Î©Î¤Î—Î£' %}
                    <div class="info-section">
                        <h2>Î•Î£Î£ÎŸ Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î±</h2>
                        <table class="info-table">
                            <tr>
                                <th>Î•Î£Î£ÎŸ:</th>
                                <td>{{ military_personnel.ÎµÏƒÏƒÎ¿|default:"-" }}</td>
                            </tr>
                            <tr>
                                <th>Î‘Î£Îœ:</th>
                                <td>{{ military_personnel.Î±ÏƒÎ¼|default:"-" }}</td>
                            </tr>
                            <tr>
                                <th>Î•Ï€Î¹Î¸Ï…Î¼Î¯Î±:</th>
                                <td>{{ military_personnel.ÎµÏ€Î¹Î¸Ï…Î¼Î¹Î±|default:"-" }}</td>
                            </tr>
                            <tr>
                                <th>ÎšÎ­Î½Ï„ÏÎ¿:</th>
                                <td>{{ military_personnel.ÎºÎµÎ½Ï„ÏÎ¿|default:"-" }}</td>
                            </tr>
                        </table>
                    </div>
                    {% endif %}

                    {% if military_personnel.Ï„Ï…Ï€Î¿Ï‚ == 'ÎœÎŸÎÎ™ÎœÎŸÎ£' %}
                    <div class="info-section">
                        <h2>Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± ÎœÏŒÎ½Î¹Î¼Î¿Ï…</h2>
                        <table class="info-table">
                            <tr>
                                <th>Î’Î±Î¸Î¼ÏŒÏ‚:</th>
                                <td>{{ military_personnel.Î²Î±Î¸Î¼Î¿Ï‚|default:"-" }}</td>
                            </tr>
                            <tr>
                                <th>Î‘Îœ:</th>
                                <td>{{ military_personnel.Î±Î¼|default:"-" }}</td>
                            </tr>
                            <tr>
                                <th>ÎœÎ¿Î½Î¬Î´Î± Î¥Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚:</th>
                                <td>{{ military_personnel.Î¼Î¿Î½Î±Î´Î±_Ï…Ï€Î·ÏÎµÏƒÎ¹Î±Ï‚|default:"-" }}</td>
                            </tr>
                            <tr>
                                <th>Î•Ï€Î¹Î¸Ï…Î¼Î¯Î±:</th>
                                <td>{{ military_personnel.ÎµÏ€Î¹Î¸Ï…Î¼Î¹Î±_Î¼Î¿Î½Î¹Î¼Î¿Ï…|default:"-" }}</td>
                            </tr>
                        </table>
                    </div>
                    {% endif %}

                    {% if military_personnel.Ï€Î±ÏÎ±Ï„Î·ÏÎ·ÏƒÎµÎ¹Ï‚ %}
                    <div class="info-section full-width">
                        <h2>Î Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚</h2>
                        <div class="notes">{{ military_personnel.Ï€Î±ÏÎ±Ï„Î·ÏÎ·ÏƒÎµÎ¹Ï‚ }}</div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script src="{% static 'citizens/js/citizen_dashboard.js' %}"></script>
{% endblock %}
